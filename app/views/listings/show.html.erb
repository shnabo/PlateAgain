<div class="card">
  <strong><%= @listing.user.name %> is offering:</strong>
  <h1><%= @listing.item_name %></h1>

  <%if @listing.picture.present? %>
    <%= image_tag @listing.picture %>
  <% end %>

  <p>Quantity: <%= @listing.quantity %></p>

  <p>This is a <strong>
    <% if @listing.perishable %>
      perishable
    <% else %>
      non-perishable
    <% end %>
    </strong> item.
    <% if @listing.expiry_date %>
      (Expiry date: <%= @listing.expiry_date %>)
    <% end %>
  </p>

  <% if @listing.notes.present? %>
    <p>Notes: <%= @listing.notes %></p>
  <% end %>

  <strong>For more information:</strong>
  <p>
    <% if @listing.contact_name.present? %>
      Contact person: <%= @listing.contact_name %><br />
    <% end %>
    <% if @listing.contact_phone.present? %>
      Phone: <%= @listing.contact_phone %><br />
    <% end %>
    <% if @listing.contact_email.present? %>
      Email: <%= @listing.contact_email %><br />
    <% end %>
    <%= link_to "Send a message to #{@listing.user.name}", new_conversation_path(user_id: @listing.user.id, subject: @listing.item_name) %>
  </p>

  <strong>Listed until: </strong>
  <h2><%= @listing.available_until_readable %></h2>

  <% if current_user === @listing.user  %>
    <%= link_to "Edit this listing", edit_listing_path %> |
    <%= link_to "Delete this listing", @listing, :method => :delete, :confirm => "Are you sure?", :title => "Delete #{@listing.item_name}"  %>
  <% end %>



  <%### MAP %>
  <div id="map"></div>
  <script>
    function initMap() {
      var directionsService = new google.maps.DirectionsService;
      var directionsDisplay = new google.maps.DirectionsRenderer;
      var map = new google.maps.Map(document.getElementById('map'));
      directionsDisplay.setMap(map);
      directionsService.route({
        origin: '<%= @current_listing %>',
        destination: '<%= current_user.full_street_address %>',
        travelMode: 'DRIVING'
      }, function(response) {
        directionsDisplay.setDirections(response);
      });
    }
  </script>
  <script async defer
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyArWXozgLx1A8ywDrWXL-xd6mCJwCiVQeo&callback=initMap">
  </script>

</div>
